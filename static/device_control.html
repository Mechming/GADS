<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Device Control</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/themes/default/style.min.css"/>
</head>
<style>
    #image-stream,
    #actions-canvas {
        margin-top: 20px;
        margin-left: 10px;
    }

    #container-div {
        height: 100%;
        width: 100%;
        display: flex;
    }

    #actions-div,
    #elements-div,
    #stream-div {
        display: inline-block;
        *display: inline;
        zoom: 1;
        vertical-align: top;
        visibility: hidden;
    }

    #actions-div {
        width: 25%;
        max-width: 650px;
        margin-left: 10px;
    }

    #elements-div {
        margin-left: 20px;
        /* border: 1px solid #000; */
    }

    #device-info-table,
    th,
    td {
        border: 1px solid black;
        border-collapse: collapse;
    }

    td {
        text-align: center;
    }

    #loading {
        visibility: hidden;
        position: fixed;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        text-align: center;
        opacity: 0.7;
        background-color: #fff;
        z-index: 99;
    }

    #loading-image {
        position: relative;
    }

    #small-loader {
        visibility: hidden;
        position: fixed;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        text-align: center;
        opacity: 0.7;
        background-color: #fff;
        z-index: 99;
    }

    #small-loader-image {
        position: relative;
    }

    #page-source {
        width: 100%;
        margin-left: 10px;
    }

    #page-source {
        list-style: none;
        padding: 0;
        margin: 0;
    }
</style>

<body>
    <div id="loading">
        <img id="loading-image" src="/static/images/loader.gif">
    </div>
    <div class="topnav">
        <link href="/static/css/top_navigation_style.css" rel="stylesheet">
        <a href="/">Home</a>
        <a href="configuration.html">Project configuration</a>
        <a href="ios-containers.html">iOS containers</a>
        <a href="android-containers.html">Android containers</a>
        <a href="project-logs.html">Project logs</a>
        <a class="active" href="device-control.html">Device Control</a>
        <a href="swagger/index.html" target="_blank">Swagger</a>
    </div>
    <div>Please select a device
        <select id="device-dropdown" name="devices" onchange="updateDeviceInfo()"></select>
    </div>
    <div id="container-div">
        <div id="stream-div" style="position: relative;">
            <div id="small-loader" style="visibility: hidden;position: absolute;">
                <img id="small-loader-image" src="/static/images/small-loader.gif">
            </div>
            <canvas id="actions-canvas" style="position: absolute;"></canvas>
            <img id="image-stream"></img>
        </div>
        <div id="actions-div">
            <h3>Device Config Info</h3>
            <table id="device-info-table" style="width:100%">
                <tr>
                    <th>Device model:</th>
                    <td id="device-model"></td>
                </tr>
                <tr>
                    <th>Device name:</th>
                    <td id="device-name"></td>
                </tr>
                <tr>
                    <th>Device OS version:</th>
                    <td id="device-os-version"></td>
                </tr>
                <tr>
                    <th>Device UDID:</th>
                    <td id="device-udid"></td>
                </tr>
                <tr>
                    <th>Appium Port:</th>
                    <td id="appium-port"></td>
                </tr>
                <tr>
                    <th>WDA Port:</th>
                    <td id="wda-port"></td>
                </tr>
                <tr>
                    <th>WDA Mjpeg Port:</th>
                    <td id="wda-mjpeg-port"></td>
                </tr>
                <tr>
                    <th>WDA URL:</th>
                    <td id="wda-url"></td>
                </tr>
                <tr>
                    <th>WDA Stream URL:</th>
                    <td id="wda-stream-url"></td>
                </tr>
                <tr>
                    <th>WDA session ID:</th>
                    <td id="wda-session-id">No session</td>
                </tr>
                <tr>
                    <th>Device size</th>
                    <th id="device-size"></th>
                </tr>
            </table>
            <div>
                <h4>Installed apps</h4>
                <select id="installed-apps-dropdown" name="installed-apps"></select>
                <button id="uninstall-app" onclick="uninstallApp()">Uninstall app</button>
            </div>
            <div>
                <h4>Installable apps</h4>
                <select id="installable-apps-dropdown" name="installable-apps"></select>
                <button id="install-app" onclick="installApp()">Install app</button>
            </div>
            <div>
                <h4>Get page source</h4>
                <button id="get-page-source" onclick="getPageSource()">Get page source</button>
            </div>
            <div>
                <h4>Element interactions</h4>
                <select id="element-query-type">
                    <option value="xpath" selected>Xpath</option>
                    <option value="class chain">Class chain</option>
                    <option value="accessibility id">Accessibility ID</option>
                    <option value="predicate string">Predicate string</option>
                </select>
                <input id="element-query" type="text"></input>
                <button id="query-elements" onclick="createElementsDropdown()">
                    Query elements
                </button></br>
                <select id="found-elements-dropdown" onchange="drawRectangle()"
                    style="visibility: hidden;"></select></br>
                <button id="tap-element" onclick="tapElement()">
                    Tap element
                </button>
                <button onclick="clearCanvas()">Clear canvas</button>
            </div>
        </div>
        <div id="elements-div">
            <div>
                <h3>Page source</h3>
                <div id="page-source"></div>
            </div>
        </div>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.12/jstree.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.fancytree/2.38.1/jquery.fancytree-all.min.js"></script>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/jquery.fancytree/2.38.1/jquery.fancytree-all-deps.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqtree/1.6.2/tree.jquery.min.js"></script>
</body>

<script>
    window.addEventListener("DOMContentLoaded", function () {
        getDeviceControlInfo();
    });

    function getDeviceControlInfo() {
        $.ajax({
            async: false,
            type: "GET",
            url: "/devices/device-control",
            success: function (data) {
                createDeviceDropdown(data)
            },
            error: function (data) {
                alert("Broken data");
            }
        });
    }

    function updateDeviceInfo(data) {
        $('#loading').css("visibility", "visible");

        $.ajax({
            async: false,
            type: "GET",
            url: "/devices/device-control",
            success: function (data) {
                // Get the device UDID from the value of the selected option
                var device_udid = $("#device-dropdown").val();

                var response = JSON.parse(data)
                for (let i = 0; i < response["ios-devices-info"].length; i++) {
                    if (response["ios-devices-info"][i].deviceConfig.device_udid === device_udid) {
                        $("#device-name").text(response["ios-devices-info"][i].deviceConfig.device_name)
                        $("#device-os-version").text(response["ios-devices-info"][i].deviceConfig.device_os_version)
                        $("#device-udid").text(response["ios-devices-info"][i].deviceConfig.device_udid)
                        $("#appium-port").text(response["ios-devices-info"][i].deviceConfig.appium_port)
                        $("#wda-port").text(response["ios-devices-info"][i].deviceConfig.wda_port)
                        $("#wda-mjpeg-port").text(response["ios-devices-info"][i].deviceConfig.wda_mjpeg_port)
                        $("#wda-stream-url").text(response["ios-devices-info"][i].deviceConfig.wda_stream_url)
                        $("#wda-url").text(response["ios-devices-info"][i].deviceConfig.wda_url)
                        $("#device-size").text(response["ios-devices-info"][i].deviceConfig.viewport_size)
                        $("#device-model").text(response["ios-devices-info"][i].deviceConfig.device_model)
                    }
                }
                createIOSAppsDropdown(data)
                createInstallableAppsDropdown(data)
                checkWDASession()
                updateIOSStreamSize()
                changeStream();
                $('#actions-div').css("visibility", "visible")
                $('#stream-div').css("visibility", "visible")
                $('#elements-div').css("visibility", "visible")
                $('#loading').css("visibility", "hidden");
            },
            error: function (data) {
                $('#loading').css("visibility", "hidden");
            }
        });
    }

    function createDeviceDropdown(data) {
        let device_dropdown = $('#device-dropdown');

        device_dropdown.empty();

        device_dropdown.append('<option>Choose device</option>');

        device_dropdown.prop('selectedIndex', 0);
        var response = JSON.parse(data)
        for (let i = 0; i < response["running-containers"].length; i++) {
            var match = response["running-containers"][i].match(/[^-]*$/)
            device_dropdown.append($('<option></option>').attr('value', match[0]).text(response["running-containers"][i]));
        }
    }

    function updateIOSStreamSize() {
        let deviceSize = $("#device-size").text()
        let dimensions = deviceSize.split('x');
        let width = dimensions[0] + "px"
        let height = dimensions[1] + "px"
        $("#image-stream").attr('width', width).attr('height', height)
        $("#actions-canvas").attr('width', width).attr('height', height)
    }

    function createIOSAppsDropdown(data) {
        // Get the device UDID from the value of the selected option
        var device_udid = $("#device-dropdown").val();

        let apps_dropdown = $('#installed-apps-dropdown');
        apps_dropdown.empty();
        apps_dropdown.prop('selectedIndex', 0);

        var response = JSON.parse(data)
        for (let i = 0; i < response["ios-devices-info"].length; i++) {
            if (response["ios-devices-info"][i].deviceConfig.device_udid === device_udid) {
                for (let x = 0; x < response["ios-devices-info"][i].installedAppsBundleIDs.length; x++) {
                    apps_dropdown.append($('<option></option>').attr('value', response["ios-devices-info"][i].installedAppsBundleIDs[x]).text(response["ios-devices-info"][i].installedAppsBundleIDs[x]));
                }
            }
        }
    }

    function createInstallableAppsDropdown(data) {
        // Get the device UDID from the value of the selected option
        var device_udid = $("#device-dropdown").val();

        let apps_dropdown = $('#installable-apps-dropdown');

        let container_name = $("#device-dropdown option:selected").text()

        apps_dropdown.empty();
        apps_dropdown.prop('selectedIndex', 0);

        var response = JSON.parse(data)
        for (let i = 0; i < response["installable-apps"].length; i++) {
            if (container_name.includes("ios_device") && response["installable-apps"][i].includes(".ipa") || response["installable-apps"][i].includes(".app")) {
                apps_dropdown.append($('<option></option>').attr('value', response["installable-apps"][i]).text(response["installable-apps"][i]));
            } else if (container_name.includes("android_device") && response["installable-apps"][i].includes(".apk")) {
                apps_dropdown.append($('<option></option>').attr('value', response["installable-apps"][i]).text(response["installable-apps"][i]));
            }
        }
    }

    function changeStream() {
        // Get the device UDID from the value of the selected option
        var device_udid = $("#device-dropdown").val();
        let image_stream = $('#image-stream')
        $.ajax({
            async: false,
            type: "GET",
            url: "/devices/device-control",
            success: function (data) {
                var response = JSON.parse(data)
                for (let i = 0; i < response["ios-devices-info"].length; i++) {
                    if (response["ios-devices-info"][i].deviceConfig.device_udid === device_udid) {
                        image_stream.attr('src', response["ios-devices-info"][i].deviceConfig.wda_stream_url)
                    }
                }
            }
        });
    }

    function uninstallApp() {
        var bundle_id = $('#installed-apps-dropdown').val();
        var device_udid = $("#device-dropdown").val();

        $.ajax({
            contentType: 'application/json',
            async: true,
            type: "POST",
            data: JSON.stringify({ "bundle_id": bundle_id }),
            url: "/ios-devices/" + device_udid + "/uninstall-app",
            success: function (data) {
                swal("Info message", "Successfully uninstalled app with bundleID:'" + bundle_id + "'", "success")
                    .then(() => {
                        location.reload();
                    });
            },
            error: function (data) {
                swal("Uninstall app error", $.parseJSON(data.responseText).error_message, "error")
            }
        });
    }

    function installApp() {
        var ipa_name = $('#installable-apps-dropdown').val();
        var device_udid = $("#device-dropdown").val();

        /* Show loading indicator until response is returned */
        $('#loading').css("visibility", "visible");

        $.ajax({
            contentType: 'application/json',
            async: true,
            type: "POST",
            data: JSON.stringify({ "ipa_name": ipa_name }),
            url: "/ios-devices/" + device_udid + "/install-app",
            success: function (data) {
                $('#loading').css("visibility", "hidden");
                swal("Install app", "Successfully installed app :'" + ipa_name + "'", "success")
                    .then(() => {
                        location.reload();
                    });
            },
            error: function (data) {
                $('#loading').css("visibility", "hidden");
                swal($.parseJSON(data.responseText).event, $.parseJSON(data.responseText).error_message, "error")
            }
        });
    }

    function checkWDASession() {
        let wda_url = $("#wda-url").text()
        let wda_session_el = $("#wda-session-id")

        $.ajax({
            type: "GET",
            url: wda_url + "/status",
            success: function (data) {
                if (data.sessionId === null) {
                    createWDASession()
                } else {
                    wda_session_el.text(data.sessionId)
                }
            },
            error: function (data) {
                console.log("could not get session")
            }
        });
    }

    function createWDASession() {
        let wda_url = $("#wda-url").text()
        let wda_session = $("#wda-session-id")
        let json = ""
        var bundle_id = ""
        if (bundle_id != "") {
            json = JSON.stringify({
                "capabilities": {
                    "firstMatch": [
                        {
                            "bundleId": "" + bundle_id + "",
                            "arguments": [],
                            "environment": {},
                            "eventloopIdleDelaySec": 0,
                            "shouldWaitForQuiescence": true,
                            "shouldUseTestManagerForVisibilityDetection": false,
                            "maxTypingFrequency": 60,
                            "shouldUseSingletonTestManager": true,
                            "shouldTerminateApp": true,
                            "forceAppLaunch": true,
                            "useNativeCachingStrategy": true,
                            "forceSimulatorSoftwareKeyboardPresence": false
                        }
                    ],
                    "alwaysMatch": {}
                }
            })
        } else {
            json = JSON.stringify({
                "capabilities": {
                    "firstMatch": [
                        {
                            "arguments": [],
                            "environment": {},
                            "eventloopIdleDelaySec": 0,
                            "shouldWaitForQuiescence": true,
                            "shouldUseTestManagerForVisibilityDetection": false,
                            "maxTypingFrequency": 60,
                            "shouldUseSingletonTestManager": true,
                            "shouldTerminateApp": true,
                            "forceAppLaunch": true,
                            "useNativeCachingStrategy": true,
                            "forceSimulatorSoftwareKeyboardPresence": false
                        }
                    ],
                    "alwaysMatch": {}
                }
            })
        }
        /* Show loading indicator until response is returned */
        $('#loading').css("visibility", "visible");

        $.ajax({
            type: "POST",
            url: wda_url + "/session",
            data: json,
            success: function (data) {
                $('#loading').css("visibility", "hidden");
                wda_session.text(data.sessionId)
            },
            error: function (data) {
                $('#loading').css("visibility", "hidden");
                swal("Error", "Could not start session for bundleID:" + bundle_id, "error")
            }
        });
    }

    function deleteWDASession() {
        let wda_url = $("#wda-url").text()
        let wda_session_id = $("#wda-session-id").text()

        /* Show loading indicator until response is returned */
        $('#loading').css("visibility", "visible");

        $.ajax({
            async: true,
            type: "DELETE",
            url: wda_url + "/session/" + wda_session_id,
            success: function () {
                $('#loading').css("visibility", "hidden");
                wda_session.text("No session")
            },
            error: function () {
                $('#loading').css("visibility", "hidden");
                swal("Error", "Could not delete session for bundleID:" + wda_session_id, "error")
            }
        });
    }

    function getPageSource() {
        let wda_url = $("#wda-url").text()
        let wda_session_id = $("#wda-session-id").text()
        let page_source = $("#page-source")
        parser = new DOMParser();

        /* Show loading indicator until response is returned */
        $('#loading').css("visibility", "visible");

        $.ajax({
            async: true,
            type: "GET",
            url: wda_url + "/session/" + wda_session_id + "/source",
            success: function (data) {
                $('#loading').css("visibility", "hidden");
                xmlDoc = parser.parseFromString(data.value, "text/xml");
                var test = generateSourceTreeView(xmlDoc.documentElement)
                var test2 = generateJSONForTree(xmlDoc.documentElement)
                console.log("TEST")
                console.log(JSON.parse(test2))

                // $('#page-source').tree({
                //     data: JSON.stringify(data.value)
                // })
                //page_source.html(test)

                page_source.jstree({
                    'core': {
                        'data': [JSON.parse(test2)]
                    }
                });

            },
            error: function () {
                $('#loading').css("visibility", "hidden");
                page_source.text("No source")
            }
        });
    }

    function generateSourceTreeView(node) {
        if (node.nodeType != 1) return "";

        var elemType = node.getAttribute('type')
        var elemX = node.getAttribute('x')
        var elemY = node.getAttribute('y')
        var elemWidth = node.getAttribute('width')
        var elemHeight = node.getAttribute('height')
        var elemName = node.getAttribute('name')
        var elemLabel = node.getAttribute('label')
        var elemVisible = node.getAttribute('visible')
        var elemEnabled = node.getAttribute('enabled')
        var elemValue = node.getAttribute('value')

        value_json = `{"type":"` + elemType + `",` +
            `"x":"` + elemX + `",` +
            `"y":"` + elemY + `",` +
            `"width":"` + elemWidth + `",` +
            `"height":"` + elemHeight + `",` +
            `"name":"` + elemName + `",` +
            `"label":"` + elemLabel + `",` +
            `"visible":"` + elemVisible + `",` +
            `"enabled":"` + elemEnabled + `",` +
            `"value":"` + elemValue + `"}`

        var jsonForChildNodes = "";

        var html = `<li class="parent" id="tree-element" data-value='` + value_json + `' onclick="drawRectangleForTree(this)">` + node.nodeName;
        var htmlForChildNodes = "";

        for (var i = 0; i < node.childNodes.length; i++) {
            htmlForChildNodes += generateSourceTreeView(node.childNodes[i]);
        }
        if (htmlForChildNodes) {
            html += `<ul class="child">` + htmlForChildNodes + `</ul>`;
        }
        html += "</li>";
        return html;
    }

    function generateJSONForTree(node) {
        if (node.nodeType != 1) return "";

        var testJson = `{"state": {"opened": false, "selected": false}, "text":"` + node.nodeName + `"`
        var jsonForChildNodes = "";

        if (node.childNodes.length > 0) {
            testJson += `, "children":[`
        }
        for (var i = 0; i < node.childNodes.length; i++) {
            jsonForChildNodes += generateJSONForTree(node.childNodes[i]);
        }
        if (jsonForChildNodes) {
            if (jsonForChildNodes.endsWith("]")) {
                testJson += `,`
            }
            testJson += jsonForChildNodes + `]`
        }
        testJson += `}`
        testJson = testJson.replaceAll("}{", "},{")
        return testJson;
    }

    function drawRectangleForTree(obj) {
        clearCanvas()
        var json = JSON.parse($(obj).attr('data-value'))
        const canvas = document.getElementById('actions-canvas')
        const context = canvas.getContext('2d')
        context.strokeStyle = '#d2eb34'
        context.lineWidth = 2;

        var elementX = json.x;
        var elementY = json.y;
        var elementWidth = json.width;
        var elementHeight = json.height;

        context.strokeRect(
            elementX,
            elementY,
            elementWidth,
            elementHeight
        );
    }

    function createElementsDropdown() {
        let wda_url = $("#wda-url").text()
        let wda_session_id = $("#wda-session-id").text()
        let query_type = $('#element-query-type option:selected').val();
        let query_string = $("#element-query").val()
        let found_elements = $('#found-elements-dropdown');

        found_elements.empty();
        found_elements.prop('selectedIndex', 0);

        let json = JSON.stringify({
            "using": query_type,
            "value": query_string
        })

        $('#loading').css("visibility", "visible");

        $.ajax({
            async: true,
            type: "POST",
            data: json,
            url: wda_url + "/session/" + wda_session_id + "/elements",
            success: function (data) {
                $('#loading').css("visibility", "hidden");
                if (data.value.length == 0) {
                    found_elements.append($('<option></option>').text("No elements found"));
                    $("#found-elements-dropdown").css("visibility", "visible")
                } else {
                    found_elements.append('<option>Choose element</option>');
                    for (let i = 0; i < data.value.length; i++) {
                        $('#loading').css("visibility", "hidden");
                        found_elements.append($('<option></option>').attr('value', data.value[i].ELEMENT).text(data.value[i].ELEMENT));
                        $("#found-elements-dropdown").css("visibility", "visible")
                    }
                }
            },
            error: function () {
                $('#loading').css("visibility", "hidden");
                found_elements.append($('<option></option>').text("Could not get elements"));
                $("#found-elements-dropdown").css("visibility", "visible")
            }
        });
    }

    function tapElement() {
        let wda_url = $("#wda-url").text()
        let wda_session_id = $("#wda-session-id").text()
        let element_id = $('#found-elements-dropdown option:selected').val();

        /* Show loading indicator until response is returned */
        $('#loading').css("visibility", "visible");

        $.ajax({
            async: true,
            type: "POST",
            data: "{}",
            url: wda_url + "/session/" + wda_session_id + "/element/" + element_id + "/click",
            success: function () {
                $('#loading').css("visibility", "hidden");
            },
            error: function () {
                $('#loading').css("visibility", "hidden");
            }
        });
    }

    //=============CANVAS INTERACTIONS===================//
    var canvas = document.getElementById("actions-canvas")

    function clearCanvas() {
        const canvas = document.getElementById('actions-canvas')
        const context = canvas.getContext('2d')
        context.clearRect(0, 0, canvas.width, canvas.height);
    }

    function drawRectangle() {
        clearCanvas()
        let wda_url = $("#wda-url").text()
        let wda_session_id = $("#wda-session-id").text()
        let element_id = $("#found-elements-dropdown").val();
        const canvas = document.getElementById('actions-canvas')
        const context = canvas.getContext('2d')
        context.strokeStyle = '#d2eb34'
        context.lineWidth = 2;

        var elementX = "";
        var elementY = "";
        var elementWidth = "";
        var elementHeight = "";

        $.ajax({
            async: false,
            type: "GET",
            url: wda_url + "/session/" + wda_session_id + "/element/" + element_id + "/rect",
            success: function (data) {
                elementX = data.value.x
                elementY = data.value.y
                elementWidth = data.value.width
                elementHeight = data.value.height
            }
        });
        context.strokeRect(
            elementX,
            elementY,
            elementWidth,
            elementHeight
        );
    }

    canvas.onmousedown = function (event) {
        var pos = getCursorPosition(canvas, event);
        tapCoordinates(pos)
    }

    function getCursorPosition(canvas, event) {
        const rect = canvas.getBoundingClientRect()
        const x = event.clientX - rect.left
        const y = event.clientY - rect.top
        console.log("x: " + x + " y: " + y)
        return [x, y];
    }

    function tapCoordinates(pos) {
        let wda_url = $("#wda-url").text()
        let wda_session_id = $("#wda-session-id").text()

        let jsonData = JSON.stringify({
            "actions": [
                {
                    "type": "pointer",
                    "id": "finger1",
                    "parameters": {
                        "pointerType": "touch"
                    },
                    "actions": [
                        {
                            "type": "pointerMove",
                            "duration": 0,
                            "x": pos[0],
                            "y": pos[1]
                        },
                        {
                            "type": "pointerDown",
                            "button": 0
                        },
                        {
                            "type": "pause",
                            "duration": 200
                        },
                        {
                            "type": "pointerUp",
                            "button": 0
                        }
                    ]
                }
            ]
        })

        showCanvasLoader()

        $.ajax({
            async: false,
            type: "POST",
            data: jsonData,
            url: wda_url + "/session/" + wda_session_id + "/actions",
            success: function () {
                hideCanvasLoader()
                console.log("Performed WDA tap")
            },
            error: function () {
                hideCanvasLoader()
                console.log("Could not perform WDA tap")
            }
        });
    }

    function showCanvasLoader() {
        const canvas = document.getElementById('actions-canvas')
        const context = canvas.getContext('2d')
        context.fillStyle = "rgba(204, 201, 194, 0.4)";
        context.fillRect(0, 0, canvas.width, canvas.height);
        $('#actions-canvas').css("cursor: not-allowed;pointer-events: none;")
        $('#small-loader-image').css("visibility", "visible");
    }

    function hideCanvasLoader() {
        $('#small-loader-image').css("visibility", "hidden");
        clearCanvas()
        $('#actions-canvas').css("cursor: allowed;pointer-events: all;")
    }


</script>
<!-- <script>
    $("#page-source").jstree()
</script> -->

</html>